<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Bot Umsatz-Rechner | BuildNSell</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;500;600;700;800;900&family=Barlow:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --black:  #0a0c0f;
  --card:   #111318;
  --card2:  #1a1d24;
  --line:   rgba(255,255,255,.1);
  --red:    #e8194b;
  --reddim: rgba(232,25,75,.25);
  --redsoft:rgba(232,25,75,.09);
  --steel:  #a0b4c8;
  --yellow: #f5f000;
  --white:  #ffffff;
  --sub:    #f3f5f7;
  --muted:  #d8e0e9;
  --good:   #4ade80;
  --r:      8px;
}

*{box-sizing:border-box;margin:0;padding:0;}
html{font-size:17px;}
body{
  background:var(--black);color:var(--white);
  font-family:'Barlow',sans-serif;font-size:1rem;line-height:1.55;
  min-height:100vh;overflow-x:hidden;
}
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:
    radial-gradient(ellipse 55% 35% at 0% 0%,rgba(232,25,75,.07) 0%,transparent 55%),
    radial-gradient(ellipse 40% 25% at 100% 100%,rgba(245,240,0,.03) 0%,transparent 50%);
}

.wrap{position:relative;z-index:1;max-width:820px;margin:0 auto;padding:64px 24px 100px;}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header{text-align:center;margin-bottom:60px;}
.eyebrow{
  display:inline-block;border:1px solid var(--reddim);color:var(--red);
  font-family:'Barlow Condensed',sans-serif;font-size:13px;font-weight:700;
  letter-spacing:.22em;text-transform:uppercase;padding:8px 20px;border-radius:100px;margin-bottom:22px;
}
h1{
  font-family:'Barlow Condensed',sans-serif;
  font-size:clamp(42px,8vw,78px);font-weight:900;line-height:1.0;
  letter-spacing:-.01em;text-transform:uppercase;margin-bottom:16px;
}
h1 .red{color:var(--red);}
.sub{font-size:18px;color:var(--sub);max-width:500px;margin:0 auto;line-height:1.6;}

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:32px;margin-bottom:12px;}
.card-head{display:flex;align-items:center;gap:14px;margin-bottom:26px;}
.card-num{
  width:36px;height:36px;border-radius:50%;background:var(--red);
  color:#fff;font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:800;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
}
.card-title{font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:800;text-transform:uppercase;letter-spacing:.04em;}
.card-sub{font-size:15px;color:var(--sub);margin-top:2px;}

/* ‚îÄ‚îÄ INPUT ‚îÄ‚îÄ */
.inp-wrap{display:flex;gap:0;}
.inp-wrap input{
  flex:1;background:var(--card2);border:2px solid var(--reddim);border-right:none;
  border-radius:var(--r) 0 0 var(--r);outline:none;color:var(--white);
  font-family:'Barlow',sans-serif;font-size:19px;font-weight:600;
  padding:16px 20px;transition:border-color .2s;
}
.inp-wrap input:focus{border-color:var(--red);}
.inp-wrap input::placeholder{color:var(--muted);}
.inp-go{
  background:var(--yellow);color:#000;border:none;
  border-radius:0 var(--r) var(--r) 0;padding:0 24px;
  font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:800;
  cursor:pointer;transition:box-shadow .15s;white-space:nowrap;
}
.inp-go:hover{box-shadow:0 4px 20px rgba(245,240,0,.35);}

.tags{display:flex;flex-wrap:wrap;gap:7px;margin-top:14px;}
.tag{
  background:transparent;border:1px solid rgba(255,255,255,.15);border-radius:100px;
  padding:7px 16px;font-size:15px;font-weight:600;color:var(--sub);
  cursor:pointer;transition:all .15s;
}
.tag:hover{border-color:var(--reddim);color:var(--red);}

/* ‚îÄ‚îÄ SLIDERS ‚îÄ‚îÄ */
.sliders{display:grid;grid-template-columns:1fr 1fr;gap:22px;}
@media(max-width:540px){.sliders{grid-template-columns:1fr;}}
.sl-top{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:10px;}
.sl-lbl{font-family:'Barlow Condensed',sans-serif;font-size:15px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:var(--sub);}
.sl-val{font-family:'Barlow Condensed',sans-serif;font-size:30px;font-weight:800;color:var(--yellow);line-height:1;}
.sl-val small{font-size:15px;color:var(--sub);font-weight:500;margin-left:3px;}
input[type=range]{
  -webkit-appearance:none;appearance:none;width:100%;height:2px;
  background:rgba(245,240,0,.2);outline:none;cursor:pointer;border-radius:2px;margin-top:6px;
}
input[type=range]::-webkit-slider-thumb{
  -webkit-appearance:none;width:3px;height:20px;background:var(--yellow);border-radius:2px;
  box-shadow:0 0 8px rgba(245,240,0,.5);
}
input[type=range]::-moz-range-thumb{width:3px;height:20px;background:var(--yellow);border-radius:2px;border:none;}
.sl-hint{font-size:15px;color:var(--sub);margin-top:6px;}

/* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
.loading{display:none;text-align:center;padding:48px 0;}
.spinner{
  width:38px;height:38px;border:3px solid rgba(232,25,75,.15);
  border-top-color:var(--red);border-radius:50%;
  animation:spin .7s linear infinite;margin:0 auto 14px;
}
.loading p{font-size:15px;color:var(--sub);}
@keyframes spin{to{transform:rotate(360deg);}}

/* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
.results{display:none;}
.branche-row{display:flex;align-items:center;gap:16px;margin-bottom:26px;padding-bottom:22px;border-bottom:1px solid var(--line);}
.branche-icon{font-size:42px;line-height:1;}
.branche-name{font-family:'Barlow Condensed',sans-serif;font-size:30px;font-weight:800;text-transform:uppercase;letter-spacing:.03em;}
.branche-desc{font-size:16px;color:var(--sub);margin-top:4px;}

.sec-lbl{font-family:'Barlow Condensed',sans-serif;font-size:13px;font-weight:700;letter-spacing:.2em;text-transform:uppercase;color:var(--steel);margin-bottom:12px;}

/* Use cases */
.use-cases{display:flex;flex-direction:column;gap:9px;margin-bottom:28px;}
.uc{display:flex;align-items:center;gap:14px;background:var(--card2);border:1px solid var(--line);border-radius:var(--r);padding:15px 18px;}
.uc.featured{border-color:var(--reddim);background:var(--redsoft);}
.uc-icon{font-size:22px;flex-shrink:0;}
.uc-body{flex:1;}
.uc-title{font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:700;letter-spacing:.03em;margin-bottom:2px;}
.uc-desc{font-size:15px;color:var(--sub);line-height:1.45;}
.uc-tag{font-family:'Barlow Condensed',sans-serif;font-size:13px;font-weight:800;letter-spacing:.08em;padding:5px 12px;border-radius:100px;white-space:nowrap;flex-shrink:0;}
.uc-tag.high{color:#fff;background:var(--red);}
.uc-tag.mid{color:#000;background:var(--steel);}

/* KPI strip */
.kpi-strip{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:var(--line);border-radius:var(--r);overflow:hidden;margin-bottom:18px;}
.kpi{background:var(--card2);padding:20px 12px;text-align:center;}
.kpi-l{font-family:'Barlow Condensed',sans-serif;font-size:13px;font-weight:700;letter-spacing:.14em;text-transform:uppercase;color:var(--sub);margin-bottom:8px;}
.kpi-v{font-family:'Barlow Condensed',sans-serif;font-size:28px;font-weight:800;line-height:1;}
.kpi-s{font-size:14px;color:var(--sub);margin-top:4px;}

/* Income bars */
.inc-bars{display:flex;flex-direction:column;gap:11px;margin-bottom:18px;}
.inc-bar{display:flex;align-items:center;gap:14px;}
.inc-lbl{font-family:'Barlow Condensed',sans-serif;font-size:16px;font-weight:600;letter-spacing:.06em;width:90px;flex-shrink:0;color:var(--sub);}
.inc-track{flex:1;height:5px;background:rgba(255,255,255,.05);border-radius:3px;overflow:hidden;}
.inc-fill{height:100%;background:var(--red);border-radius:3px;transition:width .6s cubic-bezier(.4,0,.2,1);}
.inc-num{font-family:'Barlow Condensed',sans-serif;font-size:17px;font-weight:700;width:86px;text-align:right;color:var(--red);}

/* Highlight */
.highlight{border:1px solid var(--reddim);border-radius:var(--r);padding:20px 24px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:14px;margin-bottom:12px;}
.hl-left{font-size:15px;color:var(--sub);line-height:1.6;}
.hl-left strong{color:var(--white);font-weight:700;}
.hl-num{font-family:'Barlow Condensed',sans-serif;font-size:52px;font-weight:900;color:var(--yellow);line-height:1;letter-spacing:-.01em;}

/* Insight */
.insight{border-left:3px solid var(--steel);padding:13px 18px;font-size:15px;color:var(--sub);line-height:1.6;}
.insight strong{color:var(--white);}

.reset-btn{
  background:transparent;border:1px solid var(--line);color:var(--muted);
  font-family:'Barlow',sans-serif;font-size:14px;font-weight:600;
  padding:10px 20px;border-radius:var(--r);cursor:pointer;margin-top:16px;
  transition:border-color .2s,color .2s;
}
.reset-btn:hover{border-color:var(--red);color:var(--red);}

/* ‚îÄ‚îÄ LEAD ‚îÄ‚îÄ */
.lead-card{
  background:var(--card);border:1px solid var(--line);border-radius:var(--r);
  padding:48px 36px;text-align:center;margin-top:12px;position:relative;overflow:hidden;
}
.lead-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--red);}
.lead-eyebrow{
  display:inline-block;border:1px solid var(--reddim);color:var(--red);
  font-family:'Barlow Condensed',sans-serif;font-size:12px;font-weight:700;
  letter-spacing:.2em;text-transform:uppercase;padding:7px 18px;border-radius:100px;margin-bottom:18px;
}
.lead-card h2{
  font-family:'Barlow Condensed',sans-serif;
  font-size:clamp(26px,4vw,40px);font-weight:900;text-transform:uppercase;
  letter-spacing:.02em;line-height:1.05;margin-bottom:12px;
}
.lead-card p{font-size:16px;color:var(--sub);max-width:440px;margin:0 auto 24px;line-height:1.65;}
.chips{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin-bottom:28px;}
.chip{border:1px solid rgba(160,180,200,.4);border-radius:100px;padding:7px 16px;font-size:15px;font-weight:600;color:var(--sub);}
.lead-fields{display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:480px;margin:0 auto 14px;text-align:left;}
@media(max-width:500px){.lead-fields{grid-template-columns:1fr;}}
.lf label{display:block;font-family:'Barlow Condensed',sans-serif;font-size:14px;font-weight:700;letter-spacing:.14em;text-transform:uppercase;color:var(--sub);margin-bottom:7px;}
.lf input{
  width:100%;background:var(--card2);border:1px solid var(--line);border-radius:var(--r);
  outline:none;color:var(--white);font-family:'Barlow',sans-serif;font-size:16px;font-weight:500;
  padding:13px 15px;transition:border-color .2s;
}
.lf input:focus{border-color:var(--red);}
.btn{
  display:inline-flex;align-items:center;justify-content:center;
  background:var(--yellow);color:#000;
  font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:800;
  letter-spacing:.06em;text-transform:uppercase;
  padding:17px 40px;border:none;border-radius:var(--r);cursor:pointer;
  width:100%;max-width:480px;transition:transform .15s,box-shadow .15s;
}
.btn:hover{transform:translateY(-2px);box-shadow:0 10px 32px rgba(245,240,0,.25);}
.btn:disabled{opacity:.35;cursor:not-allowed;transform:none;box-shadow:none;}
.note{font-size:14px;color:var(--sub);margin-top:12px;}
.err{display:none;color:#f87171;font-size:14px;margin-bottom:10px;}

#success{display:none;padding:16px 0;}
.success-icon{font-size:48px;margin-bottom:14px;}
.success-title{font-family:'Barlow Condensed',sans-serif;font-size:28px;font-weight:800;text-transform:uppercase;margin-bottom:8px;}
.success-sub{font-size:15px;color:var(--sub);}

.disc{margin-top:36px;font-size:13px;color:var(--muted);text-align:center;line-height:1.8;}
</style>
</head>
<body>
<div class="wrap">

  <header>
    <div class="eyebrow">ü§ñ Kostenloser AI Bot Umsatz-Rechner</div>
    <h1>Was kannst du mit<br><span class="red">AI Bots verdienen?</span></h1>
    <p class="sub">Gib eine Branche ein. Sieh sofort was ein Bot dort leistet ‚Äì und was du damit als Anbieter monatlich verdienen kannst.</p>
  </header>

  <!-- STEP 1 -->
  <div class="card">
    <div class="card-head">
      <div class="card-num">1</div>
      <div>
        <div class="card-title">F√ºr welche Branche?</div>
        <div class="card-sub">Freitext ‚Äì so spezifisch wie du willst</div>
      </div>
    </div>
    <div class="inp-wrap">
      <input type="text" id="branche-input" placeholder="z. B. Beautystudio, Zahnarztpraxis, Immobilienmakler ‚Ä¶" maxlength="80" onkeydown="if(event.key==='Enter')analyze()">
      <button class="inp-go" onclick="analyze()">‚Üí</button>
    </div>
    <div class="tags">
      <span class="tag" onclick="setTag('Beautystudio')">üíÖ Beautystudio</span>
      <span class="tag" onclick="setTag('Online-Coach')">üéØ Online-Coach</span>
      <span class="tag" onclick="setTag('Zahnarztpraxis')">ü¶∑ Zahnarztpraxis</span>
      <span class="tag" onclick="setTag('Fitnessstudio')">üí™ Fitnessstudio</span>
      <span class="tag" onclick="setTag('Immobilienmakler')">üè† Immobilienmakler</span>
      <span class="tag" onclick="setTag('Restaurant')">üçΩÔ∏è Restaurant</span>
      <span class="tag" onclick="setTag('Fahrschule')">üöó Fahrschule</span>
      <span class="tag" onclick="setTag('Steuerberater')">üìä Steuerberater</span>
    </div>
  </div>

  <!-- STEP 2 -->
  <div class="card">
    <div class="card-head">
      <div class="card-num">2</div>
      <div>
        <div class="card-title">Dein Angebot kalibrieren</div>
        <div class="card-sub">Passe Preis und Zeitraum an deine Situation an</div>
      </div>
    </div>
    <div class="sliders">
      <div>
        <div class="sl-top"><span class="sl-lbl">Setup-Fee</span><span class="sl-val" id="sv-setup">800 <small>‚Ç¨</small></span></div>
        <input type="range" id="sl-setup" min="300" max="3000" step="100" value="800" oninput="updateCalc()">
        <div class="sl-hint">Einmalig f√ºr Einrichtung & Konfiguration</div>
      </div>
      <div>
        <div class="sl-top"><span class="sl-lbl">Monatlicher Retainer</span><span class="sl-val" id="sv-retainer">197 <small>‚Ç¨/Mon</small></span></div>
        <input type="range" id="sl-retainer" min="97" max="797" step="50" value="197" oninput="updateCalc()">
        <div class="sl-hint">Betrieb, Pflege & Support</div>
      </div>
      <div>
        <div class="sl-top"><span class="sl-lbl">Neukunden pro Monat</span><span class="sl-val" id="sv-kunden">1 <small>Kunde</small></span></div>
        <input type="range" id="sl-kunden" min="1" max="10" step="1" value="1" oninput="updateCalc()">
        <div class="sl-hint">Realistisch starten: 1 Neukunde / Monat</div>
      </div>
      <div>
        <div class="sl-top"><span class="sl-lbl">M√∂gliche Einnahmen nach ‚Ä¶</span><span class="sl-val" id="sv-monate">6 <small>Monaten</small></span></div>
        <input type="range" id="sl-monate" min="3" max="24" step="1" value="6" oninput="updateCalc()">
        <div class="sl-hint">Zeitraum f√ºr deine Hochrechnung</div>
      </div>
    </div>
  </div>

  <!-- LOADING -->
  <div class="loading" id="loading">
    <div class="spinner"></div>
    <p id="loading-text">Analysiere Branche ‚Ä¶</p>
  </div>

  <!-- RESULTS -->
  <div class="results card" id="results">
    <div class="branche-row" id="branche-row"></div>
    <div class="sec-lbl">Was der Bot f√ºr diese Branche tut</div>
    <div class="use-cases" id="use-cases"></div>
    <div class="sec-lbl">Dein Umsatzpotenzial als Anbieter</div>
    <div class="kpi-strip" id="kpi-strip"></div>
    <div class="inc-bars" id="inc-bars"></div>
    <div class="highlight" id="highlight"></div>
    <div class="insight" id="insight"></div>
    <button class="reset-btn" onclick="resetCalc()">‚Ü© Andere Branche eingeben</button>
  </div>

  <!-- LEAD -->
  <div class="lead-card" id="lead-card" style="display:none;">
    <div class="lead-eyebrow">N√§chster Schritt</div>
    <h2>Hol dir deinen<br>pers√∂nlichen Umsetzungsplan</h2>
    <p>Deine Branchenauswertung kommt per Mail ‚Äì plus ein konkreter 30-Tage-Plan f√ºr deinen ersten Kunden.</p>
    <div class="chips">
      <span class="chip">‚úì Pers√∂nliche Branchenauswertung</span>
      <span class="chip">‚úì 30-Tage Umsetzungsplan</span>
      <span class="chip">‚úì BuildNSell Community</span>
    </div>
    <div id="lead-form">
      <div class="lead-fields">
        <div class="lf"><label>Vorname</label><input type="text" id="l-name" placeholder="Optional" autocomplete="given-name"></div>
        <div class="lf"><label>E-Mail *</label><input type="email" id="l-email" placeholder="deine@email.de" autocomplete="email"></div>
      </div>
      <div class="err" id="lead-err"></div>
      <button class="btn" id="lead-btn" onclick="submitLead()">Auswertung + Plan senden ‚Üí</button>
      <p class="note">Mit dem Absenden abonnierst du meinen w√∂chentlichen Newsletter rund um AI Bots und Automatisierung. Abmeldung jederzeit m√∂glich. Weitere Infos in meiner <a href="/datenschutz" target="_blank">Datenschutzerkl√§rung</a>.</p>
    </div>
    <div id="success">
      <div class="success-icon">‚úÖ</div>
      <div class="success-title">Check dein Postfach!</div>
      <p class="success-sub">Deine Auswertung ist auf dem Weg. Schau auch kurz in den Spam-Ordner.</p>
    </div>
  </div>

  <div class="disc">
    Berechnungen basieren auf realistischen DACH-Marktdaten. Individuelle Ergebnisse variieren.<br>
    <strong>BuildNSell</strong> ¬∑ henriettegladiator.de
  </div>

</div>

<script>
const GHL_WEBHOOK = 'https://services.leadconnectorhq.com/hooks/HnZ7fqRJhjMDvip73Spa/webhook-trigger/4b825528-c82a-42a3-bf07-82a7b58fee0f';

let aiData = null;
let currentBranche = '';
let calcResult = {};

function gv(id){ return parseFloat(document.getElementById(id).value)||0; }
function fmtE(n){ return Math.round(n).toLocaleString('de-DE') + ' ‚Ç¨'; }
function fmtN(n){ return Math.round(n).toLocaleString('de-DE'); }

function setTag(val){
  document.getElementById('branche-input').value = val;
  analyze();
}

/* ‚îÄ‚îÄ ANALYSE ‚îÄ‚îÄ */
async function analyze(){
  const input = document.getElementById('branche-input').value.trim();
  if(!input) return;
  currentBranche = input;

  document.getElementById('loading').style.display = 'block';
  document.getElementById('results').style.display = 'none';
  document.getElementById('lead-card').style.display = 'none';

  const msgs = ['Analysiere Branche ‚Ä¶','Ermittle AI Bot Use Cases ‚Ä¶','Berechne Marktpotenzial DACH ‚Ä¶','Bereite Auswertung vor ‚Ä¶'];
  let mi = 0;
  const ticker = setInterval(()=>{
    document.getElementById('loading-text').textContent = msgs[mi=(mi+1)%msgs.length];
  },1800);

  try{
    // API Call geht zur Netlify Function ‚Äì Key bleibt serverseitig
    const res = await fetch('/.netlify/functions/analyze', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ branche: input })
    });
    if (!res.ok) throw new Error('Function error ' + res.status);
    aiData = await res.json();
    if (aiData.error) throw new Error(aiData.error);
  } catch(e){
    aiData = {
      emoji:'üè¢', brancheNormiert:input,
      brancheBeschreibung:'AI Bots automatisieren Kundenkommunikation rund um die Uhr.',
      anzahlBetriebe:12000, marktreife:'mittel',
      useCases:[
        {icon:'üìÖ',titel:'Terminbuchung 24/7',beschreibung:'Kunden buchen Termine automatisch ohne manuellen Aufwand.',impact:'hoch'},
        {icon:'üìû',titel:'Missed Call Text Back',beschreibung:'Verpasste Anrufe werden sofort per SMS beantwortet.',impact:'hoch'},
        {icon:'ü§ñ',titel:'FAQ & Erstberatung',beschreibung:'H√§ufige Fragen werden automatisch und sofort beantwortet.',impact:'mittel'},
        {icon:'‚≠ê',titel:'Review-Automation',beschreibung:'Zufriedene Kunden werden automatisch um Bewertungen gebeten.',impact:'mittel'},
      ],
      marktInsight:'Die meisten Betriebe dieser Branche verpassen t√§glich Anfragen durch fehlende Automatisierung.'
    };
  }

  clearInterval(ticker);
  document.getElementById('loading').style.display = 'none';
  renderResults();
}

/* ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ */
function renderResults(){
  if(!aiData) return;
  document.getElementById('results').style.display = 'block';
  document.getElementById('lead-card').style.display = 'block';

  document.getElementById('branche-row').innerHTML = `
    <div class="branche-icon">${aiData.emoji}</div>
    <div>
      <div class="branche-name">${aiData.brancheNormiert}</div>
      <div class="branche-desc">${aiData.brancheBeschreibung}</div>
    </div>`;

  document.getElementById('use-cases').innerHTML = aiData.useCases.map((u,i)=>`
    <div class="uc${i<2?' featured':''}">
      <div class="uc-icon">${u.icon}</div>
      <div class="uc-body">
        <div class="uc-title">${u.titel}</div>
        <div class="uc-desc">${u.beschreibung}</div>
      </div>
      <div class="uc-tag ${u.impact}">${u.impact==='hoch'?'‚Üë Hoher Impact':'‚Üí Solider Impact'}</div>
    </div>`).join('');

  updateCalc();
}

/* ‚îÄ‚îÄ CALC ‚îÄ‚îÄ */
function updateCalc(){
  const setup    = gv('sl-setup');
  const retainer = gv('sl-retainer');
  const perMonth = gv('sl-kunden');
  const monate   = gv('sl-monate');

  document.getElementById('sv-setup').innerHTML    = setup.toLocaleString('de-DE') + ' <small>‚Ç¨</small>';
  document.getElementById('sv-retainer').innerHTML = retainer.toLocaleString('de-DE') + ' <small>‚Ç¨/Mon</small>';
  document.getElementById('sv-kunden').innerHTML   = perMonth + ' <small>' + (perMonth===1?'Kunde':'Kunden') + '</small>';
  document.getElementById('sv-monate').innerHTML   = monate + ' <small>Monaten</small>';

  if(!aiData) return;

  const churn = 0.10;
  let active = 0, setupTotal = 0, retainerTotal = 0;
  const monthly = [];

  for(let m=1; m<=monate; m++){
    active        = active*(1-churn) + perMonth;
    setupTotal   += perMonth * setup;
    retainerTotal += active  * retainer;
    monthly.push({m, active:Math.round(active*10)/10, cumul: Math.round(setupTotal+retainerTotal)});
  }

  const gesamt     = Math.round(setupTotal + retainerTotal);
  const lastActive = Math.round(active);
  const lastMRR    = Math.round(lastActive * retainer);

  // Store for webhook
  calcResult = {setup, retainer, perMonth, monate, gesamt, lastActive, lastMRR, monthly};

  // KPIs
  document.getElementById('kpi-strip').innerHTML = `
    <div class="kpi">
      <div class="kpi-l">Aktive Kunden</div>
      <div class="kpi-v" style="color:var(--red)">${lastActive}</div>
      <div class="kpi-s">nach ${monate} Monaten</div>
    </div>
    <div class="kpi">
      <div class="kpi-l">Monatl. Recurring</div>
      <div class="kpi-v" style="color:var(--good)">${fmtE(lastMRR)}</div>
      <div class="kpi-s">in Monat ${monate}</div>
    </div>
    <div class="kpi">
      <div class="kpi-l">Gesamt kumuliert</div>
      <div class="kpi-v" style="color:var(--yellow)">${fmtE(gesamt)}</div>
      <div class="kpi-s">Setup + Retainer</div>
    </div>`;

  // Bars ‚Äì 3 Zeitpunkte
  const pts = [
    monthly[Math.min(2, monthly.length-1)],
    monthly[Math.round(monate/2)-1]||monthly[monthly.length-1],
    monthly[monate-1],
  ].filter((v,i,a)=>a.findIndex(x=>x.m===v.m)===i);

  document.getElementById('inc-bars').innerHTML = pts.map(p=>`
    <div class="inc-bar">
      <div class="inc-lbl">Monat ${p.m}</div>
      <div class="inc-track"><div class="inc-fill" style="width:${Math.max(2,Math.round((p.cumul/gesamt)*100))}%"></div></div>
      <div class="inc-num">${fmtE(p.cumul)}</div>
    </div>`).join('');

  // Highlight
  const pct = ((lastActive/aiData.anzahlBetriebe)*100).toFixed(3);
  document.getElementById('highlight').innerHTML = `
    <div class="hl-left">
      <strong>${lastActive} Kunden</strong> = nur <strong>${pct} %</strong> des Markts<br>
      <span style="color:var(--muted);font-size:14px;">${fmtN(aiData.anzahlBetriebe)} Betriebe im DACH-Raum</span>
    </div>
    <div class="hl-num">${fmtE(gesamt)}</div>`;

  document.getElementById('insight').innerHTML =
    `<strong>Markt-Insight:</strong> ${aiData.marktInsight}`;
}

/* ‚îÄ‚îÄ RESET ‚îÄ‚îÄ */
function resetCalc(){
  aiData = null; currentBranche = ''; calcResult = {};
  document.getElementById('branche-input').value = '';
  document.getElementById('results').style.display = 'none';
  document.getElementById('lead-card').style.display = 'none';
  document.getElementById('branche-input').focus();
}

/* ‚îÄ‚îÄ LEAD / WEBHOOK ‚îÄ‚îÄ */
async function submitLead(){
  const fname = document.getElementById('l-name').value.trim();
  const email = document.getElementById('l-email').value.trim();
  const errEl = document.getElementById('lead-err');
  const btn   = document.getElementById('lead-btn');

  errEl.style.display = 'none';
  if(!email||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
    errEl.textContent = 'Bitte trag eine g√ºltige E-Mail-Adresse ein.';
    errEl.style.display = 'block';
    return;
  }

  btn.disabled = true;
  btn.textContent = 'Wird gesendet ‚Ä¶';

  // Use Cases als lesbarer String
  const useCasesText = (aiData?.useCases||[])
    .map((u,i)=>`${i+1}. ${u.titel} (${u.impact === 'hoch' ? 'Hoher Impact' : 'Solider Impact'}): ${u.beschreibung}`)
    .join('\n');

  const payload = {
    // Kontakt
    firstName:          fname,
    email:              email,

    // Meta
    source:             'BuildNSell AI Bot Rechner',
    tags:               'ai-bot-rechner,affiliate',

    // Branche
    branche:            aiData?.brancheNormiert || currentBranche,
    brancheBeschreibung:aiData?.brancheBeschreibung || '',
    brancheEmoji:       aiData?.emoji || '',

    // Markt
    marktBetriebeDACH:  aiData?.anzahlBetriebe || 0,
    marktreife:         aiData?.marktreife || '',
    marktInsight:       aiData?.marktInsight || '',

    // Use Cases
    useCase1Titel:      aiData?.useCases?.[0]?.titel || '',
    useCase1Beschreibung: aiData?.useCases?.[0]?.beschreibung || '',
    useCase1Impact:     aiData?.useCases?.[0]?.impact || '',
    useCase2Titel:      aiData?.useCases?.[1]?.titel || '',
    useCase2Beschreibung: aiData?.useCases?.[1]?.beschreibung || '',
    useCase2Impact:     aiData?.useCases?.[1]?.impact || '',
    useCase3Titel:      aiData?.useCases?.[2]?.titel || '',
    useCase3Beschreibung: aiData?.useCases?.[2]?.beschreibung || '',
    useCase3Impact:     aiData?.useCases?.[2]?.impact || '',
    useCase4Titel:      aiData?.useCases?.[3]?.titel || '',
    useCase4Beschreibung: aiData?.useCases?.[3]?.beschreibung || '',
    useCase4Impact:     aiData?.useCases?.[3]?.impact || '',
    useCasesGesamt:     useCasesText,

    // Kalkulation
    setupFee:           calcResult.setup || 0,
    retainerMonatlich:  calcResult.retainer || 0,
    neukundenProMonat:  calcResult.perMonth || 0,
    planungsmonate:     calcResult.monate || 0,
    aktiveKundenEnde:   calcResult.lastActive || 0,
    recurringEnde:      calcResult.lastMRR || 0,
    gesamtPotenzial:    calcResult.gesamt || 0,
  };

  try{
    await fetch(GHL_WEBHOOK,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(payload)
    });
  } catch(e){ console.warn('Webhook error:',e); }

  document.getElementById('lead-form').style.display = 'none';
  document.getElementById('success').style.display   = 'block';
}

document.getElementById('l-email')?.addEventListener('keydown',e=>{
  if(e.key==='Enter') submitLead();
});
</script>
</body>
</html>
